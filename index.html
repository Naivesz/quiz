<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Jeopardy Quiz - Transparent OBS Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Kanit:wght@600;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --blue-dark: #020617;
            --blue-highlight: #3b82f6;
            --red-accent: #e11d48;
            --text-gold: #fde047;
            --font-show: 'Anton', sans-serif;
            --font-text: 'Kanit', sans-serif;
        }

        /* WICHTIG: Hintergrund der Seite muss transparent sein für OBS */
        html, body {
            background-color: transparent !important;
            margin: 0; padding: 0;
            height: 100vh; width: 100vw;
            overflow: hidden;
            color: white;
            font-family: var(--font-text);
        }

        /* Klick-Sperre für Spieler */
        body.is-player * { cursor: default !important; }
        body.is-player .host-only { display: none !important; }
        body.is-player button, body.is-player .quiz-card { pointer-events: none !important; }

        .top-bar {
            display: grid; grid-template-columns: 20% 1fr 20%; 
            align-items: center; padding: 10px 30px;
            background: var(--blue-dark); border-bottom: 3px solid var(--blue-highlight);
        }

        /* Transparente Kamera-Slots */
        .gm-cam-slot, .player-slot {
            aspect-ratio: 16/9;
            background: transparent !important; /* Hier schimmert OBS durch */
            border: 3px solid var(--red-accent);
            border-radius: 10px;
            position: relative;
        }

        .player-slot { border-color: #333; }
        .player-slot.active-buzzer { border-color: var(--red-accent); box-shadow: 0 0 20px var(--red-accent); }
        .player-slot.selecting { border-color: var(--text-gold); border-style: dashed; }

        .gm-label, .player-info {
            position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            background: var(--red-accent); padding: 2px 12px; font-size: 0.8rem;
            font-family: var(--font-show); border-radius: 4px; white-space: nowrap;
        }

        .logo-text { font-family: var(--font-show); font-size: 2rem; color: var(--text-gold); text-align: center; margin: 0; }

        #game-board {
            display: grid; grid-template-columns: repeat(6, 1fr);
            gap: 10px; padding: 20px 30px; background: rgba(2, 6, 23, 0.9); /* Leicht transparentes Board */
            height: 55vh;
        }

        .category-header {
            background: linear-gradient(to bottom, var(--red-accent), #991b1b);
            text-align: center; font-family: var(--font-show); border-radius: 6px;
            display: flex; align-items: center; justify-content: center; font-size: 0.9rem;
        }

        .quiz-card {
            background: #1e3a8a; border: 2px solid var(--blue-highlight);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-family: var(--font-show); color: var(--text-gold); cursor: pointer;
        }

        .quiz-card.used { opacity: 0.1; }

        .player-area {
            display: grid; grid-template-columns: repeat(5, 1fr);
            gap: 15px; padding: 20px 30px; background: var(--blue-dark);
        }

        #question-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(2, 6, 23, 0.98); z-index: 2000;
            flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="gm-cam-slot"><div class="gm-label">HOST</div></div>
    <div class="nav-controls">
        <h1 class="logo-text">QUIZ DUELL</h1>
        <div class="host-only" style="text-align: center;">
            <button onclick="switchBoard(1)">B1</button>
            <button onclick="switchBoard(2)">B2</button>
            <button onclick="resetGame()" style="background:red;">RESET</button>
        </div>
    </div>
    <div id="current-turn-display" style="text-align:right; color:var(--text-gold); font-family:var(--font-show);">AM ZUG: -</div>
</div>

<div id="game-board"></div>

<div id="question-overlay">
    <div id="buzzer-status" style="font-family:var(--font-show); font-size:2rem; color:var(--text-gold);"></div>
    <div id="question-content" style="font-size:3rem; text-align:center; padding:40px;"></div>
    <div class="host-only">
        <button onclick="handleAnswer(true)" style="background:green; padding:20px;">RICHTIG</button>
        <button onclick="handleAnswer(false)" style="background:red; padding:20px;">FALSCH</button>
        <button onclick="closeQuestion()" style="padding:20px;">ZURÜCK</button>
    </div>
</div>

<div class="player-area" id="player-area"></div>

<script>
    // DEINE FIREBASE KONFIGURATION (Bleibt gleich)
    const firebaseConfig = {
      apiKey: "AIzaSyBP2hzronbnt530dAEr906xMS8xzmg3bpo",
      authDomain: "quizshownaives.firebaseapp.com",
      databaseURL: "https://quizshownaives-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "quizshownaives",
      storageBucket: "quizshownaives.firebasestorage.app",
      messagingSenderId: "569001129434",
      appId: "1:569001129434:web:87f6e6af8ac09296163ce3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('game_state');

    const urlParams = new URLSearchParams(window.location.search);
    const myPlayerIndex = urlParams.has('p') ? parseInt(urlParams.get('p')) - 1 : null;
    const isHost = (myPlayerIndex === null);

    if (!isHost) {
        document.body.classList.add('is-player');
        const name = prompt("Dein Name:");
        if(name) db.child('players').child(myPlayerIndex).update({ name: name });
    }

    const boards = {
        1: { 
            "KATEGORIE 1": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}],
            "KATEGORIE 2": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}],
            "KATEGORIE 3": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}],
            "KATEGORIE 4": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}],
            "KATEGORIE 5": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}],
            "KATEGORIE 6": [{pts:100,q:"Frage?",a:"Antwort"},{pts:200,q:"Frage?",a:"Antwort"},{pts:300,q:"Frage?",a:"Antwort"},{pts:500,q:"Frage?",a:"Antwort"}] 
        }
    };

    let localState = {};

    db.on('value', (snapshot) => {
        localState = snapshot.val();
        if(localState) updateUI();
    });

    function updateUI() {
        const boardDiv = document.getElementById('game-board');
        boardDiv.innerHTML = '';
        const data = boards[localState.currentBoard || 1];
        
        // Header
        Object.keys(data).forEach(c => {
            const h = document.createElement('div'); h.className = 'category-header'; h.innerText = c;
            boardDiv.appendChild(h);
        });

        // Cards
        for(let i=0; i<4; i++) {
            Object.keys(data).forEach(c => {
                const q = data[c][i];
                const cardId = `${localState.currentBoard}-${c}-${i}`;
                const card = document.createElement('div'); card.className = 'quiz-card';
                if(localState.usedCards?.[localState.currentBoard]?.includes(cardId)) card.classList.add('used');
                card.innerText = q.pts;
                card.onclick = () => { if(isHost) openQuestion(q, cardId); };
                boardDiv.appendChild(card);
            });
        }

        // Spieler
        const area = document.getElementById('player-area');
        area.innerHTML = '';
        localState.players.forEach((p, i) => {
            const s = document.createElement('div');
            s.className = `player-slot ${localState.activePlayerIndex === i ? 'active-buzzer' : ''}`;
            s.innerHTML = `<div class="player-info">${p.name}: ${p.score}</div>`;
            area.appendChild(s);
        });

        // Overlay
        document.getElementById('question-overlay').style.display = localState.overlayOpen ? 'flex' : 'none';
        document.getElementById('question-content').innerText = (isHost || localState.showAnswerMode) ? (localState.showAnswerMode ? localState.currentAnswer : localState.currentQuestion) : "FRAGE STEHT...";
        document.getElementById('current-turn-display').innerText = "AM ZUG: " + (localState.activePlayerIndex !== null ? localState.players[localState.activePlayerIndex].name : "NIEMAND");
    }

    function openQuestion(q, id) {
        let used = localState.usedCards || {1:[], 2:[]};
        if(!used[localState.currentBoard]) used[localState.currentBoard] = [];
        used[localState.currentBoard].push(id);
        db.update({ overlayOpen: true, currentQuestion: q.q, currentAnswer: q.a, currentPoints: q.pts, usedCards: used, activePlayerIndex: null, canBuzz: true, showAnswerMode: false });
    }

    function handleAnswer(correct) {
        let players = [...localState.players];
        let idx = localState.activePlayerIndex;
        if(idx === null) return;
        if(correct) {
            players[idx].score += localState.currentPoints;
            db.update({ players: players, showAnswerMode: true, canBuzz: false });
        } else {
            players[idx].score -= (localState.currentPoints / 2);
            db.update({ players: players, activePlayerIndex: null, canBuzz: true });
        }
    }

    function closeQuestion() { db.update({overlayOpen: false, activePlayerIndex: null, canBuzz: false}); }
    function resetGame() { if(confirm("Reset?")) db.set({ players: [{name:"S1",score:0},{name:"S2",score:0},{name:"S3",score:0},{name:"S4",score:0},{name:"S5",score:0}], currentBoard: 1, usedCards: {1:[]}, overlayOpen: false, activePlayerIndex: null, canBuzz: false }); }

    window.addEventListener('keydown', (e) => {
        if (!isHost && localState.canBuzz && e.code === "Space") {
            db.update({ activePlayerIndex: myPlayerIndex, canBuzz: false });
        }
    });
</script>
</body>
</html>
