<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Jeopardy Quiz Show - Stable Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Kanit:wght@600;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --blue-dark: #020617; --blue-main: #0a192f; --blue-card: #1e3a8a;
            --blue-highlight: #3b82f6; --red-accent: #e11d48; --green-success: #22c55e;
            --text-gold: #fde047; --font-show: 'Anton', sans-serif; --font-text: 'Kanit', sans-serif;
        }
        html, body { background-color: transparent !important; margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden; color: white; font-family: var(--font-text); display: flex; flex-direction: column; }
        
        body.is-player .host-only { display: none !important; }

        .top-bar { display: grid; grid-template-columns: 20% 1fr 20%; align-items: center; padding: 10px 30px; background: var(--blue-dark); border-bottom: 3px solid var(--blue-highlight); }
        .gm-cam-slot { width: 100%; aspect-ratio: 16/9; border: 3px solid var(--red-accent); border-radius: 10px; position: relative; background: rgba(255,255,255,0.05); }
        .logo-text { font-family: var(--font-show); font-size: 2.2rem; color: var(--text-gold); text-align: center; margin: 0; }
        
        /* FLEXBOX statt festem GRID für automatisches Layout */
        #game-board { 
            display: flex; justify-content: space-evenly; gap: 10px; 
            padding: 15px 30px; background: var(--blue-dark); flex-grow: 1; 
        }

        .category-column { display: flex; flex-direction: column; gap: 10px; flex: 1; max-width: 250px; }

        .category-header { 
            background: linear-gradient(to bottom, var(--red-accent), #991b1b); 
            text-align: center; font-family: var(--font-show); border-radius: 6px; 
            min-height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1rem; 
            border: 1px solid rgba(255,255,255,0.2);
        }

        .quiz-card { 
            background: linear-gradient(145deg, var(--blue-card), var(--blue-main)); 
            border: 2px solid var(--blue-highlight); border-radius: 6px; 
            flex-grow: 1; display: flex; align-items: center; justify-content: center; 
            font-size: 2rem; font-family: var(--font-show); color: var(--text-gold); cursor: pointer; 
        }
        .quiz-card.used { opacity: 0.05; cursor: default; }

        .player-area { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; padding: 15px 30px; background: var(--blue-dark); border-top: 5px solid var(--blue-highlight); }
        .player-slot { aspect-ratio: 16/9; border: 2px solid #333; position: relative; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .player-slot.active-buzzer { border-color: var(--red-accent); box-shadow: 0 0 20px var(--red-accent); transform: scale(1.05); }
        .player-slot.selecting { border-color: var(--text-gold); border-style: dashed; }
        .player-info { position: absolute; bottom: 0; width: 100%; background: rgba(225, 29, 72, 0.95); text-align: center; font-weight: 900; padding: 5px 0; font-size: 0.9rem; }

        #question-overlay { display: none; position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98); z-index: 2000; flex-direction: column; align-items: center; justify-content: center; }
        #question-content { font-size: 3rem; text-align: center; padding: 40px; max-width: 80%; line-height: 1.2; }
        
        .host-only button { margin: 5px; padding: 10px 20px; font-family: var(--font-show); cursor: pointer; border-radius: 5px; border: none; color: white; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="gm-cam-slot"><div style="position:absolute; bottom:-10px; left:50%; transform:translateX(-50%); background:var(--red-accent); padding:2px 10px; font-size:0.7rem; border-radius:4px;">NAIVES</div></div>
    <div class="nav-controls">
        <h1 class="logo-text">QUIZ DUELL</h1>
        <div class="host-only">
            <button onclick="switchBoard(1)" style="background:var(--blue-card);">BOARD 1</button>
            <button onclick="switchBoard(2)" style="background:var(--blue-card);">BOARD 2</button>
            <button onclick="resetGame()" style="background:var(--red-accent);">RESET ALL</button>
        </div>
    </div>
    <div id="current-turn-display" style="color:var(--text-gold); font-family:var(--font-show); text-align:right; font-size:1.2rem;">AM ZUG: -</div>
</div>

<div id="game-board"></div>

<div id="question-overlay">
    <div id="buzzer-status" style="font-family:var(--font-show); font-size:2rem; color:var(--text-gold); margin-bottom:20px;"></div>
    <div id="question-content"></div>
    <div class="host-only" style="margin-top:30px;">
        <button onclick="handleAnswer(true)" style="background:var(--green-success); font-size:1.5rem;">RICHTIG (+)</button>
        <button onclick="handleAnswer(false)" style="background:var(--red-accent); font-size:1.5rem;">FALSCH (-)</button>
        <button onclick="closeQuestion()" style="background:#444;">X SCHLIESSEN</button>
    </div>
</div>

<div class="player-area" id="player-area"></div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBP2hzronbnt530dAEr906xMS8xzmg3bpo",
      authDomain: "quizshownaives.firebaseapp.com",
      databaseURL: "https://quizshownaives-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "quizshownaives",
      storageBucket: "quizshownaives.firebasestorage.app",
      messagingSenderId: "569001129434",
      appId: "1:569001129434:web:87f6e6af8ac09296163ce3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('game_state');

    const urlParams = new URLSearchParams(window.location.search);
    const myPlayerIndex = urlParams.has('p') ? parseInt(urlParams.get('p')) - 1 : null;
    const isHost = (myPlayerIndex === null);

    if (!isHost) {
        document.body.classList.add('is-player');
        let n = prompt("Dein Name:");
        if(n) db.child('players').child(myPlayerIndex).update({ name: n });
    }

    const boards = {
        1: { 
            "ALLGEMEIN": [{pts:100,q:"Was ist 5x5?",a:"25"},{pts:200,q:"Größtes Land?",a:"Russland"},{pts:300,q:"Farbe von Smaragden?",a:"Grün"},{pts:500,q:"Hauptstadt Japan?",a:"Tokio"}],
            "TECHNIK": [{pts:100,q:"Was ist HTML?",a:"Sprache"},{pts:200,q:"Gründer von Apple?",a:"Steve Jobs"},{pts:300,q:"Was ist eine URL?",a:"Link"},{pts:500,q:"Sitz von Google?",a:"Mountain View"}]
        },
        2: { 
            "EXTRA 1": [{pts:200,q:"Frage 1?",a:"Antwort 1"},{pts:400,q:"Frage 2?",a:"Antwort 2"},{pts:600,q:"Frage 3?",a:"Antwort 3"},{pts:1000,q:"Frage 4?",a:"Antwort 4"}] 
        }
    };

    let localState = {};
    db.on('value', (snap) => {
        localState = snap.val();
        if(localState && localState.players) updateUI();
    });

    function updateUI() {
        const boardDiv = document.getElementById('game-board');
        boardDiv.innerHTML = '';
        const currentBoardNum = localState.currentBoard || 1;
        const data = boards[currentBoardNum];

        Object.keys(data).forEach(catName => {
            const col = document.createElement('div');
            col.className = 'category-column';
            
            const head = document.createElement('div');
            head.className = 'category-header';
            head.innerText = catName;
            col.appendChild(head);

            data[catName].forEach((q, i) => {
                const id = `${currentBoardNum}-${catName}-${i}`;
                const card = document.createElement('div');
                card.className = 'quiz-card';
                if(localState.usedCards?.[currentBoardNum]?.includes(id)) card.classList.add('used');
                card.innerText = q.pts;
                card.onclick = () => { if(isHost && !card.classList.contains('used')) openQuestion(q, id); };
                col.appendChild(card);
            });
            boardDiv.appendChild(col);
        });

        const area = document.getElementById('player-area');
        area.innerHTML = '';
        localState.players.forEach((p, i) => {
            const s = document.createElement('div');
            s.className = `player-slot ${localState.activePlayerIndex === i ? 'active-buzzer' : ''} ${localState.selectingPlayerIndex === i ? 'selecting' : ''}`;
            s.innerHTML = `<div class="player-info">${p.name}: ${p.score}</div>`;
            s.onclick = () => { if(isHost) db.update({ selectingPlayerIndex: i }); };
            area.appendChild(s);
        });

        document.getElementById('question-overlay').style.display = localState.overlayOpen ? 'flex' : 'none';
        if(localState.overlayOpen) {
            document.getElementById('question-content').innerText = isHost ? `FRAGE: ${localState.currentQuestion}\n\nANTWORT: ${localState.currentAnswer}` : localState.currentQuestion;
        }

        let statusText = "";
        if(localState.activePlayerIndex !== null) statusText = localState.players[localState.activePlayerIndex].name.toUpperCase() + " HAT GEBUZZERT!";
        else if(localState.canBuzz) statusText = "BUZZER FREI!";
        document.getElementById('buzzer-status').innerText = statusText;
        document.getElementById('current-turn-display').innerText = "AM ZUG: " + (localState.selectingPlayerIndex !== null ? localState.players[localState.selectingPlayerIndex].name : "-");
    }

    function openQuestion(q, id) {
        let used = localState.usedCards || {};
        if(!used[localState.currentBoard]) used[localState.currentBoard] = [];
        used[localState.currentBoard].push(id);
        db.update({ overlayOpen: true, currentQuestion: q.q, currentAnswer: q.a, currentPoints: q.pts, usedCards: used, canBuzz: true, activePlayerIndex: null });
    }

    function handleAnswer(correct) {
        let idx = localState.activePlayerIndex;
        if(idx === null) return;
        let p = [...localState.players];
        if(correct) {
            p[idx].score += localState.currentPoints;
            db.update({ players: p, overlayOpen: false, activePlayerIndex: null, canBuzz: false, selectingPlayerIndex: idx });
        } else {
            p[idx].score -= Math.floor(localState.currentPoints / 2);
            db.update({ players: p, activePlayerIndex: null, canBuzz: true });
        }
    }

    function closeQuestion() { db.update({ overlayOpen: false, activePlayerIndex: null, canBuzz: false }); }
    function switchBoard(n) { db.update({ currentBoard: n }); }
    function resetGame() { if(confirm("ALLES RESETTEN?")) db.set({ currentBoard: 1, usedCards: {1:[], 2:[]}, overlayOpen: false, activePlayerIndex: null, selectingPlayerIndex: 0, canBuzz: false, players: [{name:"Spieler 1",score:0},{name:"Spieler 2",score:0},{name:"Spieler 3",score:0},{name:"Spieler 4",score:0},{name:"Spieler 5",score:0}] }); }

    window.onkeydown = (e) => {
        if(!isHost && localState.canBuzz && e.code === "Space") {
            db.update({ activePlayerIndex: myPlayerIndex, canBuzz: false });
        }
    };
</script>
</body>
</html>
